(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(2509)}])},2509:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return I}});var l=s(5893),a=s(7294),r=s(5068),n=s(5269),i=e=>{let{onLoginSuccess:t,pinCode:s}=e,[r,n]=(0,a.useState)(""),[i,c]=(0,a.useState)("");return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-sm text-center",children:[(0,l.jsx)("img",{src:"https://storage.googleapis.com/poker-enfermos/f1-logo.png",alt:"F1 Logo",className:"w-32 h-24 mx-auto object-contain"}),(0,l.jsx)("h1",{className:"text-4xl font-bold mt-4 text-slate-100",children:"F1 Night "}),(0,l.jsx)("p",{className:"text-slate-400 mt-2 mb-8",children:"Ingrese el PIN."}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r===s?t():(c("PIN inv\xe1lido. Int\xe9ntalo de nuevo."),n(""))},children:[(0,l.jsx)("input",{type:"password",value:r,onChange:e=>{let t=e.target.value;/^\d*$/.test(t)&&t.length<=4&&(n(t),c(""))},maxLength:4,className:"w-full text-4xl tracking-[1em] text-center bg-slate-800 border-2 border-slate-600 rounded-lg p-4 text-slate-100 focus:border-[#FF1801] focus:outline-none transition-colors",placeholder:"----",autoFocus:!0}),i&&(0,l.jsx)("p",{className:"text-red-500 mt-4",children:i}),(0,l.jsx)("button",{type:"submit",disabled:4!==r.length,className:"w-full bg-[#FF1801] text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-[#E61601] disabled:bg-slate-700 disabled:cursor-not-allowed transition-all",children:"INGRESAR"})]})]})})};let c=e=>{let{className:t}=e;return(0,l.jsxs)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,l.jsx)("path",{d:"M17 2H7C6.44772 2 6 2.44772 6 3V4C6 4.55228 6.44772 5 7 5H8V6C8 8.76142 10.2386 11 13 11H11C8.23858 11 6 8.76142 6 6V5H7C7.55228 5 8 4.55228 8 4V3C8 2.44772 7.55228 2 7 2H5C3.34315 2 2 3.34315 2 5V8C2 9.10457 2.89543 10 4 10V18C4 19.6569 5.34315 21 7 21H17C18.6569 21 20 19.6569 20 18V10C21.1046 10 22 9.10457 22 8V5C22 3.34315 20.6569 2 19 2H17ZM17 3C17.5523 3 18 3.44772 18 4V5H16V6C16 8.76142 13.7614 11 11 11H13C15.7614 11 18 8.76142 18 6V5H17C16.4477 5 16 4.55228 16 4V3H17ZM4 4H5C5.55228 4 6 4.44772 6 5V6C6 8.76142 8.23858 11 11 11H13C15.7614 11 18 8.76142 18 6V5C18 4.44772 18.4477 4 19 4H20C20.5523 4 21 4.44772 21 5V8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8V5C3 4.44772 3.44772 4 4 4ZM18 18C18 18.5523 17.5523 19 17 19H7C6.44772 19 6 18.5523 6 18V11.261C7.2497 12.2858 9.01426 13 11 13H13C14.9857 13 16.7503 12.2858 18 11.261V18Z"}),(0,l.jsx)("path",{d:"M12 14C10.3431 14 9 15.3431 9 17C9 18.6569 10.3431 20 12 20C13.6569 20 15 18.6569 15 17C15 15.3431 13.6569 14 12 14ZM12 16C12.5523 16 13 16.4477 13 17C13 17.5523 12.5523 18 12 18C11.4477 18 11 17.5523 11 17C11 16.4477 11.4477 16 12 16Z"})]})},o=e=>{let{className:t}=e;return(0,l.jsxs)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,l.jsx)("path",{d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z"}),(0,l.jsx)("path",{d:"M12 6C11.4477 6 11 6.44772 11 7V12C11 12.5523 11.4477 13 12 13H16C16.5523 13 17 12.5523 17 12C17 11.4477 16.5523 11 16 11H13V7C13 6.44772 12.5523 6 12 6Z"}),(0,l.jsx)("path",{d:"M13 2H11V5H13V2Z"}),(0,l.jsx)("path",{d:"M6.00355 4.58941L4.58934 6.00363L6.36696 7.78125L7.78118 6.36704L6.00355 4.58941Z"})]})},d=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM10.7071 16.2929L7.20711 12.7929C6.81658 12.4024 6.81658 11.7692 7.20711 11.3787C7.59763 10.9881 8.2308 10.9881 8.62132 11.3787L11.2929 14.0503L15.9393 9.40381C16.3398 9.00329 16.973 9.00329 17.3735 9.40381C17.774 9.80434 17.774 10.4375 17.3735 10.838L11.7071 16.4745C11.5196 16.662 11.2652 16.7558 11.011 16.7497C10.9295 16.7479 10.849 16.7282 10.7753 16.6917C10.7684 16.6883 10.7616 16.6848 10.7547 16.6812L10.7071 16.2929Z"})})},x=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"})})},m=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M15.7782 4.22183L19.7782 8.22183L8.77817 19.2218H4.77817V15.2218L15.7782 4.22183ZM17.1924 2.80762L14.364 0L2.36396 12V21.2218H11.5857L23.5857 9.22183L20.7573 6.3934L17.1924 2.80762Z"})})},u=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M7 6V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7ZM9 4V6H15V4H9Z"})})},h=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M13 7.82843V20H11V7.82843L5.63604 13.1924L4.22183 11.7782L12 4L19.7782 11.7782L18.364 13.1924L13 7.82843Z"})})},p=e=>{let{className:t}=e;return(0,l.jsx)("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,l.jsx)("path",{d:"M11 16.1716V4H13V16.1716L18.364 10.8076L19.7782 12.2218L12 20L4.22183 12.2218L5.63604 10.8076L11 16.1716Z"})})};var g=e=>{let{players:t,circuits:s,onSetupComplete:r}=e,[n,i]=(0,a.useState)(1),[c,o]=(0,a.useState)([]),[d,x]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[g,b]=(0,a.useState)(3),[j,f]=(0,a.useState)(3),[N,v]=(0,a.useState)(1),[w,y]=(0,a.useState)(1),[C,F]=(0,a.useState)("turn"),[k,L]=(0,a.useState)(!0),[S,I]=(0,a.useState)("average"),[P,T]=(0,a.useState)(!1),[E,M]=(0,a.useState)("average"),[V,B]=(0,a.useState)(2),H=e=>{let t=c.find(t=>t.id===e.id)?c.filter(t=>t.id!==e.id):[...c,e];o(t),x(t)},A=(e,t)=>{let s=[...d],l="up"===t?e-1:e+1;l>=0&&l<s.length&&([s[e],s[l]]=[s[l],s[e]],x(s))},R=(e,t)=>{let s=[...m],l="up"===t?e-1:e+1;l>=0&&l<s.length&&([s[e],s[l]]=[s[l],s[e]],u(s))},O=e=>{u(t=>t.find(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])};return(0,l.jsx)("div",{className:"max-w-2xl mx-auto p-4 md:p-8",children:(0,l.jsxs)("div",{className:"bg-slate-800/50 backdrop-blur-sm p-6 rounded-xl shadow-2xl border border-slate-700",children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2.5",children:(0,l.jsx)("div",{className:"bg-[#FF1801] h-2.5 rounded-full",style:{width:"".concat(n/6*100,"%")}})})}),(0,l.jsx)("div",{className:"min-h-[350px]",children:(()=>{switch(n){case 1:return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"1. Seleccionar Jugadores"}),(0,l.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:t.map(e=>(0,l.jsxs)("div",{onClick:()=>H(e),className:"p-4 border-2 rounded-lg cursor-pointer transition-all ".concat(c.find(t=>t.id===e.id)?"border-[#FF1801] bg-red-900/50":"border-slate-600 bg-slate-800 hover:bg-slate-700"),children:[(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-20 h-20 rounded-full mx-auto"}),(0,l.jsx)("p",{className:"text-center font-semibold mt-2",children:e.name})]},e.id))})]});case 2:return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"2. Orden de Inicio"}),(0,l.jsx)("div",{className:"space-y-2",children:d.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("span",{className:"font-bold text-lg w-6",children:[t+1,"."]}),(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-10 h-10 rounded-full"}),(0,l.jsx)("span",{className:"font-semibold",children:e.name})]}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)("button",{onClick:()=>A(t,"up"),disabled:0===t,className:"p-2 rounded-md bg-slate-600 hover:bg-slate-500 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,l.jsx)(h,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>A(t,"down"),disabled:t===d.length-1,className:"p-2 rounded-md bg-slate-600 hover:bg-slate-500 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,l.jsx)(p,{className:"w-5 h-5"})})]})]},e.id))})]});case 3:let e=s.filter(e=>!m.find(t=>t.id===e.id));return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"3. Selecciona & Ordenar Circuitos"}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Circuitos"}),(0,l.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 bg-slate-900/50 rounded-lg",children:e.map(e=>(0,l.jsx)("div",{onClick:()=>O(e),className:"p-2 bg-slate-700 rounded-lg cursor-pointer hover:bg-slate-600",children:e.name},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold mb-2",children:"Orden de Carrrera"}),(0,l.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 bg-slate-900/50 rounded-lg",children:m.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between bg-slate-700 p-2 rounded-lg",children:[(0,l.jsxs)("span",{onClick:()=>O(e),className:"cursor-pointer flex-grow",children:[t+1,". ",e.name]}),(0,l.jsxs)("div",{className:"flex gap-1 flex-shrink-0 ml-2",children:[(0,l.jsx)("button",{onClick:()=>R(t,"up"),disabled:0===t,className:"p-1 rounded-md bg-slate-600 hover:bg-slate-500 disabled:opacity-50",children:(0,l.jsx)(h,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:()=>R(t,"down"),disabled:t===m.length-1,className:"p-1 rounded-md bg-slate-600 hover:bg-slate-500 disabled:opacity-50",children:(0,l.jsx)(p,{className:"w-4 h-4"})})]})]},e.id))})]})]})]});case 4:return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"4. Configuraci\xf3n"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-2",children:"Vueltas por Turno"}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{onClick:()=>b(3),className:"flex-1 p-3 rounded-lg ".concat(3===g?"bg-[#FF1801]":"bg-slate-700"),children:"3 Vueltas"}),(0,l.jsx)("button",{onClick:()=>b(5),className:"flex-1 p-3 rounded-lg ".concat(5===g?"bg-[#FF1801]":"bg-slate-700"),children:"5 Vueltas"})]})]}),5===g&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-2",children:"En 5-vueltas, valen:"}),(0,l.jsxs)("div",{className:"flex items-center gap-4 bg-slate-700 p-3 rounded-lg",children:[(0,l.jsx)("input",{type:"checkbox",id:"best4of5",checked:k,onChange:e=>L(e.target.checked),className:"h-5 w-5 rounded bg-slate-800 border-slate-600 text-[#FF1801] focus:ring-red-500"}),(0,l.jsx)("label",{htmlFor:"best4of5",children:"Mejores 4 de 5 vueltas para el promedio"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-slate-400 mb-2",children:["Turnos por Circuito (",j,")"]}),(0,l.jsx)("input",{type:"range",min:"1",max:"10",value:j,onChange:e=>f(parseInt(e.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-[#FF1801]"})]})]})]});case 5:return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"5. Puntaje"}),(0,l.jsxs)("div",{className:"space-y-4 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg text-[#FF1801]",children:"Puntaje Principal por Turno"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Elija como asignar  (1ro: 3, 2do: 2, 3ro: 1) puntos"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-2",children:"Se entregan puntos en base a:"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>I("average"),className:"flex-1 p-2 rounded-lg ".concat("average"===S?"bg-[#FF1801]":"bg-slate-700"),children:"Mejor Promedio"}),(0,l.jsx)("button",{onClick:()=>I("lap"),className:"flex-1 p-2 rounded-lg ".concat("lap"===S?"bg-[#FF1801]":"bg-slate-700"),children:"Vuelta R\xe1pida"}),(0,l.jsx)("button",{onClick:()=>I("both"),className:"flex-1 p-2 rounded-lg ".concat("both"===S?"bg-[#FF1801]":"bg-slate-700"),children:"Los Dos"})]})]}),"both"===S&&(0,l.jsxs)("div",{className:"space-y-4 pt-4 border-t border-slate-600/50",children:[(0,l.jsxs)("div",{className:"flex gap-4 p-2 bg-slate-800 rounded-lg",children:[(0,l.jsx)("button",{onClick:()=>T(!1),className:"flex-1 p-2 rounded-lg ".concat(P?"bg-slate-700":"bg-[#FF1801]"),children:"Igual (3-2-1 each)"}),(0,l.jsx)("button",{onClick:()=>T(!0),className:"flex-1 p-2 rounded-lg ".concat(P?"bg-[#FF1801]":"bg-slate-700"),children:"Usar Multiplicador"})]}),P&&(0,l.jsxs)("div",{className:"space-y-4 p-3 bg-slate-800 rounded-lg",children:[(0,l.jsxs)("label",{className:"block text-slate-400 mb-2",children:["Apply x",V," multiplicar por:"]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>M("average"),className:"flex-1 p-2 rounded-lg ".concat("average"===E?"bg-[#FF1801]":"bg-slate-700"),children:"Mejor Promedio"}),(0,l.jsx)("button",{onClick:()=>M("lap"),className:"flex-1 p-2 rounded-lg ".concat("lap"===E?"bg-[#FF1801]":"bg-slate-700"),children:"Vuelta R\xe1pida"})]}),(0,l.jsx)("input",{type:"range",min:"2",max:"5",value:V,onChange:e=>B(parseInt(e.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-[#FF1801]"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4 mt-6 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg text-[#FF1801]",children:"Puntos Extra"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-slate-400 mb-2",children:["Puntos extra por Vuelta R\xe1pida (",N,")"]}),(0,l.jsx)("input",{type:"range",min:"0",max:"5",value:N,onChange:e=>v(parseInt(e.target.value)),className:"w-full accent-[#FF1801]"})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-slate-400 mb-2",children:["Puntos Extra por Mejor Promedio (",w,")"]}),(0,l.jsx)("input",{type:"range",min:"0",max:"5",value:w,onChange:e=>y(parseInt(e.target.value)),className:"w-full accent-[#FF1801]"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-2",children:"Entregar puntos extra por:"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>F("turn"),className:"flex-1 p-2 rounded-lg ".concat("turn"===C?"bg-[#FF1801]":"bg-slate-700"),children:"Vuelta"}),(0,l.jsx)("button",{onClick:()=>F("circuit"),className:"flex-1 p-2 rounded-lg ".concat("circuit"===C?"bg-[#FF1801]":"bg-slate-700"),children:"Circuito"}),(0,l.jsx)("button",{onClick:()=>F("both"),className:"flex-1 p-2 rounded-lg ".concat("both"===C?"bg-[#FF1801]":"bg-slate-700"),children:"Los Dos"})]})]})]})]});case 6:let{scoringMultiplier:a}="both"===S&&P?{scoringMultiplier:{appliesTo:E,factor:V}}:{scoringMultiplier:null};return(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"6. Revisi\xf3n e Inicio"}),(0,l.jsxs)("div",{className:"bg-slate-800 p-4 rounded-lg space-y-4 text-slate-300",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Orden de Jugadores:"}),(0,l.jsx)("ol",{className:"list-decimal list-inside pl-4",children:d.map(e=>(0,l.jsx)("li",{children:e.name},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Circuit Order:"}),(0,l.jsx)("ol",{className:"list-decimal list-inside pl-4",children:m.map(e=>(0,l.jsx)("li",{children:e.name},e.id))})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Vueltas/Turnos:"})," ",g," ",5===g?"(Using best 4 laps: ".concat(k?"Yes":"No",")"):""]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Turnos/Circuito:"})," ",j]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Sistema de Puntaje:"})," Basado en ",S,"both"===S&&a?" (x".concat(a.factor," on ").concat(a.appliesTo,")"):"both"===S?" (Equal points)":""]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Puntos Extra (Vuelta R\xe1pida):"})," ",N]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Puntos Extra (Mejor Promedio):"})," ",w]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Entrega Puntos Extra:"})," Por ",C]})]})]});default:return null}})()}),(0,l.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,l.jsx)("button",{onClick:()=>i(e=>e-1),disabled:1===n,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Regresar"}),n<6?(0,l.jsx)("button",{onClick:()=>i(e=>e+1),disabled:(1===n||2===n)&&c.length<2||3===n&&m.length<1,className:"bg-[#FF1801] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#E61601] disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"}):(0,l.jsx)("button",{onClick:()=>{if(d.length<2){alert("Seleccionar y Ordenar al menos 2 jugadores"),i(1);return}if(m.length<1){alert("Seleccionar al menos 1 circuito"),i(3);return}r({players:d,circuits:m,lapsPerTurn:g,turnsPerCircuit:j,scoringMethod:S,scoringMultiplier:"both"===S&&P?{appliesTo:E,factor:V}:null,pointsForBestLap:N,pointsForBestAverage:w,awardBestTimeFor:C,useBest4Of5Laps:k})},className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700",children:"Iniciar!"})]})]})})};let b=e=>{if(null==e)return"-:--.---";let t=e/1e3;return"".concat(Math.floor(t/60),":").concat(Math.floor(t%60).toString().padStart(2,"0"),".").concat((e%1e3).toString().padStart(3,"0"))},j=e=>6e4*(parseInt(e.min)||0)+1e3*(parseInt(e.sec)||0)+(parseInt(e.ms)||0),f=e=>{let{value:t,onChange:s,maxLength:a,placeholder:r,isBest:n}=e,i="bg-slate-700 border-slate-600 text-slate-200";return"session"===n&&(i="bg-green-900/50 border-green-500 text-green-300"),"historical"===n&&(i="bg-purple-900/50 border-purple-500 text-purple-300"),(0,l.jsx)("input",{type:"tel",value:t,onChange:e=>{/^\d*$/.test(e.target.value)&&s(e.target.value)},maxLength:a,placeholder:r,className:"w-full text-center text-2xl md:text-3xl font-mono p-2 rounded-md border-2 focus:outline-none focus:border-[#FF1801] transition-colors ".concat(i)})};var N=e=>{var t,s,r,n,i,x,m;let{gameState:u,players:h,onTurnComplete:p,onNextCircuit:g,onGameEnd:N}=e,{settings:v,circuits:w,currentCircuitIndex:y,currentTurn:C,currentPlayerIndex:F,sessionBestLap:k,sessionBestAverage:L,playerOrder:S}=u,I=w[y],P=S[F],T=h.find(e=>e.id===P),[E,M]=(0,a.useState)(()=>Array(v.lapsPerTurn).fill({min:"",sec:"",ms:""})),[V,B]=(0,a.useState)(null),H=(e,t,s)=>{let l=[...E];l[e]={...l[e],[t]:s},M(l)},A=(0,a.useCallback)(()=>{let e=E.map(j).filter(e=>e>0).sort((e,t)=>e-t);if(e.length<3)return B(null),null;let t=5===v.lapsPerTurn&&v.useBest4Of5Laps&&5===e.length?e.slice(0,4):e;if(0===t.length)return B(null),null;let s=Math.round(t.reduce((e,t)=>e+t,0)/t.length);return B(s),s},[E,v.lapsPerTurn,v.useBest4Of5Laps]);if((0,a.useEffect)(()=>{A()},[E,A]),(0,a.useEffect)(()=>{M(Array(v.lapsPerTurn).fill({min:"",sec:"",ms:""})),B(null)},[F,C,y,v.lapsPerTurn]),(null===(t=u.circuitResults[y])||void 0===t?void 0:t.turns.length)===v.turnsPerCircuit&&(null===(r=u.circuitResults[y])||void 0===r?void 0:null===(s=r.turns[v.turnsPerCircuit-1])||void 0===s?void 0:s.length)===v.players.length){let e=y===v.circuits.length-1,t=[...null!==(x=null===(n=u.circuitResults[y])||void 0===n?void 0:n.turns.flat().reduce((e,t)=>{let s=(e.get(t.playerId)||0)+t.turnScore;return e.set(t.playerId,s),e},new Map))&&void 0!==x?x:[]].sort((e,t)=>t[1]-e[1]),s=null!==(m=null===(i=h.find(e=>{var s;return e.id===(null===(s=t[0])||void 0===s?void 0:s[0])}))||void 0===i?void 0:i.name)&&void 0!==m?m:"N/A";return(0,l.jsxs)("div",{className:"text-center p-8 max-w-lg mx-auto bg-slate-800 rounded-xl",children:[(0,l.jsx)(c,{className:"w-24 h-24 mx-auto text-yellow-400"}),(0,l.jsx)("h2",{className:"text-3xl font-bold mt-4",children:"Circuit Complete!"}),(0,l.jsx)("p",{className:"text-xl text-slate-300 mt-2",children:I.name}),(0,l.jsxs)("p",{className:"text-2xl font-bold text-yellow-400 mt-4",children:["Winner: ",s]}),(0,l.jsxs)("div",{className:"mt-6 text-left",children:[(0,l.jsx)("h3",{className:"font-bold text-lg mb-2",children:"Circuit Standings:"}),t.map((e,t)=>{var s;let[a,r]=e;return(0,l.jsxs)("div",{className:"flex justify-between p-2 bg-slate-700 rounded mb-1",children:[(0,l.jsxs)("span",{children:[t+1,". ",null===(s=h.find(e=>e.id===a))||void 0===s?void 0:s.name]}),(0,l.jsxs)("span",{className:"font-bold",children:[r," pts"]})]},a)})]}),(0,l.jsx)("button",{onClick:e?N:g,className:"mt-8 w-full bg-[#FF1801] text-white font-bold py-3 px-4 rounded-lg hover:bg-[#E61601] transition-all",children:e?"Ver Resultados Finales":"Continuar al Siguiente Circuito"})]})}let R=F===v.players.length-1?null:h.find(e=>e.id===S[F+1]);return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[(0,l.jsx)("div",{className:"bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700",children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-[#FF1801]",children:I.name}),(0,l.jsxs)("p",{className:"text-slate-400",children:["Turno ",C," de ",v.turnsPerCircuit]})]}),(0,l.jsxs)("div",{className:"text-lg font-semibold mt-2 sm:mt-0 text-right",children:[(0,l.jsxs)("p",{children:["Corriendo: ",T.name]}),R&&(0,l.jsxs)("p",{className:"text-sm text-slate-400",children:["Siguiente: ",R.name]})]})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-slate-800 p-3 rounded-lg",children:[(0,l.jsxs)("h3",{className:"text-slate-400 text-sm font-semibold mb-2 flex items-center gap-2",children:[(0,l.jsx)(c,{className:"w-4 h-4 text-[#FF1801]"})," Mejores Hist\xf3ricos"]}),(0,l.jsxs)("div",{className:"flex justify-around font-mono text-lg",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"Vuelta:"})," ",b(I.historicalBestLap)]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"Prom:"})," ",b(I.historicalBestAverage)]})]})]}),(0,l.jsxs)("div",{className:"bg-slate-800 p-3 rounded-lg",children:[(0,l.jsxs)("h3",{className:"text-slate-400 text-sm font-semibold mb-2 flex items-center gap-2",children:[(0,l.jsx)(o,{className:"w-4 h-4 text-green-400"})," Mejores de la Sesi\xf3n"]}),(0,l.jsxs)("div",{className:"flex justify-around font-mono text-lg",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"Vuelta:"})," ",(0,l.jsx)("span",{className:"text-green-400",children:b(k)})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"Prom:"})," ",(0,l.jsx)("span",{className:"text-green-400",children:b(L)})]})]})]})]}),(0,l.jsxs)("div",{className:"bg-slate-800/50 backdrop-blur-sm p-6 rounded-xl border border-slate-700 space-y-4",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-center",children:["Ingresa los Tiempos de Vuelta de ",T.name]}),E.map((e,t)=>{let s=j(e);if(s>0){let a=null===I.historicalBestLap||void 0===I.historicalBestLap||s<I.historicalBestLap,r=k===1/0||null==k||s<k,n=a?"historical":r?"session":void 0;return(0,l.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,l.jsxs)("span",{className:"font-bold text-slate-400 w-16",children:["Vuelta ",t+1]}),(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-2",children:[(0,l.jsx)(f,{value:e.min,onChange:e=>H(t,"min",e),maxLength:1,placeholder:"M",isBest:n}),(0,l.jsx)(f,{value:e.sec,onChange:e=>H(t,"sec",e),maxLength:2,placeholder:"SS",isBest:n}),(0,l.jsx)(f,{value:e.ms,onChange:e=>H(t,"ms",e),maxLength:3,placeholder:"ms",isBest:n})]})]},t)}return(0,l.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,l.jsxs)("span",{className:"font-bold text-slate-400 w-16",children:["Vuelta ",t+1]}),(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-2",children:[(0,l.jsx)(f,{value:e.min,onChange:e=>H(t,"min",e),maxLength:1,placeholder:"M"}),(0,l.jsx)(f,{value:e.sec,onChange:e=>H(t,"sec",e),maxLength:2,placeholder:"SS"}),(0,l.jsx)(f,{value:e.ms,onChange:e=>H(t,"ms",e),maxLength:3,placeholder:"ms"})]})]},t)}),null!==V&&(()=>{let e=null===I.historicalBestAverage||void 0===I.historicalBestAverage||V<I.historicalBestAverage,t=L===1/0||null==L||V<L,s=e?"historical":t?"session":"normal";return(0,l.jsxs)("div",{className:"pt-4 border-t text-center rounded-lg p-3 ".concat("historical"===s?"border-purple-500 bg-purple-900/20":"session"===s?"border-green-500 bg-green-900/20":"border-slate-700"),children:[(0,l.jsx)("p",{className:"text-slate-400",children:"Tiempo Promedio"}),(0,l.jsx)("p",{className:"text-3xl font-mono font-bold ".concat("historical"===s?"text-purple-400":"session"===s?"text-green-400":"text-slate-200"),children:b(V)}),"historical"===s&&(0,l.jsx)("p",{className:"text-xs text-purple-300 mt-1",children:"\uD83C\uDFC6 NEW HISTORICAL RECORD!"}),"session"===s&&(0,l.jsx)("p",{className:"text-xs text-green-300 mt-1",children:"⭐ NEW SESSION BEST!"}),5===v.lapsPerTurn&&v.useBest4Of5Laps&&(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Based on best 4 laps"})]})})(),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("button",{onClick:()=>{M(Array(v.lapsPerTurn).fill({min:"",sec:"",ms:""})),B(null)},className:"bg-slate-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700 transition-all flex items-center justify-center gap-2",children:[(0,l.jsx)("span",{className:"text-lg",children:"↻"})," Limpiar Tiempos"]}),(0,l.jsxs)("button",{onClick:()=>{let e=E.map(j).filter(e=>e>0);if(e.length!==v.lapsPerTurn){alert("Por favor ingresa todos los ".concat(v.lapsPerTurn," tiempos de vuelta."));return}p(P,e)},className:"bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-all flex items-center justify-center gap-2",children:[(0,l.jsx)(d,{className:"w-6 h-6"})," Grabar Tiempos y Terminar Turno"]})]})]})]})};let v=e=>{if(null==e)return"-:--.---";let t=e/1e3;return"".concat(Math.floor(t/60),":").concat(Math.floor(t%60).toString().padStart(2,"0"),".").concat((e%1e3).toString().padStart(3,"0"))},w=e=>{let{gameState:t,players:s,onNewGame:a}=e,r=Object.entries(t.playerStats).map(e=>{let[t,l]=e;return{player:s.find(e=>e.id===t),...l}}).filter(e=>e.player).sort((e,t)=>t.totalScore-e.totalScore),n=r[0];return(0,l.jsxs)("div",{className:"text-center p-4 md:p-8 max-w-2xl mx-auto",children:[(0,l.jsx)(c,{className:"w-28 h-28 mx-auto text-yellow-400"}),(0,l.jsx)("h1",{className:"text-4xl font-black mt-4 uppercase tracking-wider",children:"\xa1Juego Terminado!"}),(0,l.jsx)("h2",{className:"text-2xl text-slate-300 mt-2",children:"El ganador es..."}),n&&(0,l.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-4",children:[(0,l.jsx)("img",{src:n.player.imageUrl,alt:n.player.name,className:"w-20 h-20 rounded-full border-4 border-yellow-400"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-4xl font-bold text-yellow-300",children:n.player.name}),(0,l.jsxs)("p",{className:"text-xl font-semibold text-slate-200",children:[n.totalScore," Puntos"]})]})]}),(0,l.jsxs)("div",{className:"mt-8 text-left bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[(0,l.jsx)("h3",{className:"font-bold text-xl mb-3 text-center",children:"Clasificaci\xf3n Final"}),r.map((e,t)=>{let{player:s,totalScore:a}=e;return(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 rounded mb-2 ".concat(0===t?"bg-yellow-400/20":"bg-slate-700/50"),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("span",{className:"font-bold text-lg w-6",children:[t+1,"."]}),(0,l.jsx)("img",{src:s.imageUrl,alt:s.name,className:"w-8 h-8 rounded-full"}),(0,l.jsx)("span",{className:"font-semibold",children:s.name})]}),(0,l.jsxs)("span",{className:"font-bold text-lg",children:[a," pts"]})]},s.id)})]}),(0,l.jsx)("button",{onClick:a,className:"mt-8 w-full bg-[#FF1801] text-white font-bold py-3 px-4 rounded-lg hover:bg-[#E61601] transition-all",children:"Start a New Game"})]})},y=e=>{var t,s,r;let{circuits:n,players:i,gameHistory:c}=e,[o,d]=(0,a.useState)((null===(t=n[0])||void 0===t?void 0:t.id)||""),x=(0,a.useMemo)(()=>{let e={};return i.forEach(t=>{e[t.id]={lapRecords:0,avgRecords:0}}),n.forEach(t=>{t.bestLapHolderId&&e[t.bestLapHolderId]&&e[t.bestLapHolderId].lapRecords++,t.bestAverageHolderId&&e[t.bestAverageHolderId]&&e[t.bestAverageHolderId].avgRecords++}),e},[n,i]),m=(0,a.useMemo)(()=>{let e={};i.forEach(t=>{e[t.id]={wins:0,circuitWinCounts:{}}}),c.forEach(t=>{let s=t.state;s&&s.circuitResults&&s.circuitResults.forEach(t=>{if(!t.circuitId)return;let s=new Map;t.turns.flat().forEach(e=>{s.set(e.playerId,(s.get(e.playerId)||0)+e.turnScore)});let l=[...s.entries()].sort((e,t)=>t[1]-e[1]);if(l.length>0){let s=l[0][0];e[s]&&(e[s].wins++,e[s].circuitWinCounts[t.circuitId]=(e[s].circuitWinCounts[t.circuitId]||0)+1)}})});let t={};return i.forEach(s=>{var l;let a=e[s.id],r=null,i=0;for(let e in a.circuitWinCounts)a.circuitWinCounts[e]>i&&(i=a.circuitWinCounts[e],r=e);let c=r?(null===(l=n.find(e=>e.id===r))||void 0===l?void 0:l.name)||"Unknown":"N/A";t[s.id]={wins:a.wins,mostWonCircuit:c}}),t},[c,i,n]),u=n.find(e=>e.id===o),h=e=>{if(!e)return"-";let t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"-";let s=Math.abs(new Date().getTime()-t.getTime());return"".concat(Math.floor(s/864e5)," days")};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Player Career Stats"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.map(e=>{var t,s,a;let r=x[e.id],n=m[e.id];return(0,l.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-lg text-center border border-slate-700",children:[(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-16 h-16 rounded-full mx-auto mb-2 border-2 border-slate-600"}),(0,l.jsx)("h4",{className:"font-bold text-lg",children:e.name}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 mt-3 text-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-slate-400 text-xs font-semibold",children:"GANA"}),(0,l.jsx)("p",{className:"font-bold text-xl text-[#FF1801]",children:null!==(t=null==n?void 0:n.wins)&&void 0!==t?t:0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-slate-400 text-xs font-semibold",children:"M VLTA"}),(0,l.jsx)("p",{className:"font-bold text-xl text-[#FF1801]",children:null!==(s=null==r?void 0:r.lapRecords)&&void 0!==s?s:0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-slate-400 text-xs font-semibold",children:"M PROM"}),(0,l.jsx)("p",{className:"font-bold text-xl text-[#FF1801]",children:null!==(a=null==r?void 0:r.avgRecords)&&void 0!==a?a:0})]})]}),(0,l.jsxs)("div",{className:"mt-3 pt-2 border-t border-slate-700/50",children:[(0,l.jsx)("p",{className:"text-slate-400 text-xs font-semibold",children:"GANA MAS EN"}),(0,l.jsx)("p",{className:"font-semibold text-[#FF1801] truncate",title:(null==n?void 0:n.mostWonCircuit)||"N/A",children:(null==n?void 0:n.mostWonCircuit)||"N/A"})]})]},e.id)})}),(0,l.jsx)("h2",{className:"text-2xl font-bold mt-4",children:"Records Hist\xf3ricos"}),(0,l.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[(0,l.jsx)("label",{htmlFor:"circuit-select",className:"sr-only",children:"Seleccionar Circuito"}),(0,l.jsxs)("select",{id:"circuit-select",value:o,onChange:e=>d(e.target.value),className:"w-full p-3 bg-slate-700 border border-slate-600 rounded-lg mb-4 focus:ring-2 focus:ring-[#FF1801] focus:border-[#FF1801]",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"-- Circuito --"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),u&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-semibold text-lg",children:"Vuelta R\xe1pida"}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,l.jsx)("p",{className:"font-mono text-2xl text-[#FF1801] font-bold",children:v(u.historicalBestLap)}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"font-semibold",children:(null===(s=i.find(e=>e.id===u.bestLapHolderId))||void 0===s?void 0:s.name)||"N/A"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:u.historicalBestLapDate?new Date(u.historicalBestLapDate).toLocaleDateString():"No date"})]})]}),(0,l.jsxs)("p",{className:"text-xs text-slate-500 mt-2 text-right",children:["Record desde hace ",h(u.historicalBestLapDate)]})]}),(0,l.jsxs)("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-semibold text-lg",children:"Best Average"}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,l.jsx)("p",{className:"font-mono text-2xl text-green-400 font-bold",children:v(u.historicalBestAverage)}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"font-semibold",children:(null===(r=i.find(e=>e.id===u.bestAverageHolderId))||void 0===r?void 0:r.name)||"N/A"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:u.historicalBestAverageDate?new Date(u.historicalBestAverageDate).toLocaleDateString():"No date"})]})]}),(0,l.jsxs)("p",{className:"text-xs text-slate-500 mt-2 text-right",children:["Record desde hace ",h(u.historicalBestAverageDate)]})]})]})]})]})};var C=e=>{var t,s;let{gameState:r,players:n,circuits:i,gameHistory:c,onNewGame:o}=e,[d,x]=(0,a.useState)("standings"),[m,u]=(0,a.useState)("lap"),h=(0,a.useMemo)(()=>{if(!r)return{};let e={};r.settings.players.forEach(t=>{e[t.id]={first:0,second:0,third:0}});let{scoringMethod:t}=r.settings;return r.circuitResults.forEach(s=>{s.turns.forEach(s=>{if(!(s.length<r.settings.players.length)){if("average"===t||"both"===t){let t=[...s].sort((e,t)=>{var s,l;return(null!==(s=e.averageTime)&&void 0!==s?s:1/0)-(null!==(l=t.averageTime)&&void 0!==l?l:1/0)});t[0]&&e[t[0].playerId].first++,t[1]&&e[t[1].playerId].second++,t[2]&&e[t[2].playerId].third++}if("lap"===t||"both"===t){let t=s.map(e=>({playerId:e.playerId,bestLap:Math.min(...e.lapTimes)})).sort((e,t)=>e.bestLap-t.bestLap);t[0]&&e[t[0].playerId].first++,t[1]&&e[t[1].playerId].second++,t[2]&&e[t[2].playerId].third++}}})}),e},[r]);if(r.currentCircuitIndex>=r.settings.circuits.length)return(0,l.jsx)(w,{gameState:r,players:n,onNewGame:o});let p=[...(null==r?void 0:r.lapTimesLog)||[]].sort((e,t)=>e.time-t.time),g=null===(t=p[0])||void 0===t?void 0:t.time,b=[];r.circuitResults.forEach(e=>{var t;let s=(null===(t=i.find(t=>t.id===e.circuitId))||void 0===t?void 0:t.name)||"Unknown Circuit";e.turns.forEach((e,t)=>{e.forEach(e=>{e.averageTime&&b.push({playerId:e.playerId,circuitName:s,turn:t+1,time:e.averageTime})})})});let j=b.sort((e,t)=>e.time-t.time),f=null===(s=j[0])||void 0===s?void 0:s.time,N=Object.entries(r.playerStats).map(e=>{let[t,s]=e;return{player:n.find(e=>e.id===t),...s}}).filter(e=>e.player).sort((e,t)=>t.totalScore-e.totalScore),C=()=>{if(!r)return null;let{settings:e}=r,{scoringMethod:t,scoringMultiplier:s,pointsForBestLap:a,pointsForBestAverage:n,awardBestTimeFor:i}=e,c="";switch(t){case"average":c="Best Average Time";break;case"lap":c="Fastest Lap";break;case"both":c="Best Average & Fastest Lap"}return(0,l.jsxs)("div",{className:"mt-6 bg-slate-800/50 p-4 rounded-lg border border-slate-700 text-sm text-slate-300 space-y-2",children:[(0,l.jsx)("h4",{className:"font-bold text-lg mb-2 text-center text-[#FF1801]",children:"Reglas de Puntaje"}),(0,l.jsxs)("p",{children:["• ",(0,l.jsx)("strong",{children:"Puntos Principales:"})," en base a ",(0,l.jsx)("strong",{children:c}),"."]}),"both"===t&&s&&(0,l.jsxs)("p",{className:"pl-4",children:["↳ Con un multipicador de ",(0,l.jsxs)("strong",{children:["x",s.factor," "]})," en puntos de ",(0,l.jsx)("strong",{children:"average"===s.appliesTo?"Best Average":"Fastest Lap"}),"."]}),"both"===t&&!s&&(0,l.jsx)("p",{className:"pl-4",children:"↳ Puntos iguales en las dos opciones de puntaje (3-2-1)."}),(a>0||n>0)&&(0,l.jsxs)("p",{children:["• ",(0,l.jsx)("strong",{children:"Puntos Extra:"})," Entregados por ",(0,l.jsx)("strong",{children:i}),":",(0,l.jsxs)("span",{className:"ml-2",children:[a," pt(s) por Vuelta R\xe1pida"]}),(0,l.jsxs)("span",{className:"ml-2",children:["& ",n," pt(s) por Mejor Promedio."]})]}),5===e.lapsPerTurn&&(0,l.jsxs)("p",{children:["• ",(0,l.jsx)("strong",{children:"C\xe1lculo de veutlas:"})," Promedios se calculan en base a  ",(0,l.jsx)("strong",{children:e.useBest4Of5Laps?"best 4 of 5 laps":"all 5 laps"}),"."]})]})};return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,l.jsxs)("div",{className:"mb-4 flex border-b border-slate-700",children:[(0,l.jsx)("button",{onClick:()=>x("standings"),className:"py-2 px-4 font-semibold ".concat("standings"===d?"border-b-2 border-[#FF1801] text-[#FF1801]":"text-slate-400"),children:"Posiciones"}),(0,l.jsx)("button",{onClick:()=>x("nightly"),className:"py-2 px-4 font-semibold ".concat("nightly"===d?"border-b-2 border-[#FF1801] text-[#FF1801]":"text-slate-400"),children:"Resultados Campeonato"}),(0,l.jsx)("button",{onClick:()=>x("top"),className:"py-2 px-4 font-semibold ".concat("top"===d?"border-b-2 border-[#FF1801] text-[#FF1801]":"text-slate-400"),children:"Top "})]}),(0,l.jsx)("div",{children:(()=>{switch(d){case"standings":return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700 space-y-2",children:[(0,l.jsx)("h3",{className:"font-bold text-xl mb-3 text-center",children:"Posiciones"}),N.map((e,t)=>{let{player:s,totalScore:a,bestLaps:r,bestAverages:n}=e,i=h[s.id]||{first:0,second:0,third:0};return(0,l.jsxs)("div",{className:"p-3 rounded-lg ".concat(0===t?"bg-[#FF1801]/20 border border-[#FF1801]/50":"bg-slate-700/50"),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"font-black text-xl w-6 text-center",children:t+1}),(0,l.jsx)("img",{src:s.imageUrl,alt:s.name,className:"w-10 h-10 rounded-full"}),(0,l.jsx)("span",{className:"font-semibold text-lg",children:s.name})]}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsxs)("p",{className:"font-bold text-xl",children:[a," pts"]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-1 text-center text-xs bg-slate-900/40 p-2 rounded-md",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold text-slate-400",children:"1st"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:i.first})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold text-slate-400",children:"2nd"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:i.second})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold text-slate-400",children:"3rd"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:i.third})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold text-slate-400",children:"Best Laps"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:r})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold text-slate-400",children:"Best Avgs"}),(0,l.jsx)("p",{className:"font-bold text-lg",children:n})]})]})]},s.id)})]}),C()]});case"nightly":return(0,l.jsxs)("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700",children:[(0,l.jsxs)("div",{className:"mb-4 flex border-b border-slate-600",children:[(0,l.jsx)("button",{onClick:()=>u("lap"),className:"py-2 px-4 font-semibold ".concat("lap"===m?"border-b-2 border-[#FF1801] text-[#FF1801]":"text-slate-400"),children:"By Lap"}),(0,l.jsx)("button",{onClick:()=>u("average"),className:"py-2 px-4 font-semibold ".concat("average"===m?"border-b-2 border-[#FF1801] text-[#FF1801]":"text-slate-400"),children:"By Average"})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm text-left text-slate-300",children:[(0,l.jsx)("thead",{className:"text-xs text-slate-400 uppercase bg-slate-700/50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",className:"px-4 py-3",children:"#"}),(0,l.jsx)("th",{scope:"col",className:"px-4 py-3",children:"Circuito"}),(0,l.jsx)("th",{scope:"col",className:"px-4 py-3",children:"Jugador"}),(0,l.jsx)("th",{scope:"col",className:"px-4 py-3",children:"Turno"}),"lap"===m&&(0,l.jsx)("th",{scope:"col",className:"px-4 py-3",children:"Vuelta"}),(0,l.jsx)("th",{scope:"col",className:"px-4 py-3 text-right",children:"Tiempo"}),(0,l.jsx)("th",{scope:"col",className:"px-4 py-3 text-right",children:"Delta"})]})}),(0,l.jsx)("tbody",{children:("lap"===m?p:j).map((e,t)=>{let s=n.find(t=>t.id===e.playerId),a=e.time-("lap"===m?g:f);return(0,l.jsxs)("tr",{className:"border-b border-slate-700 hover:bg-slate-800/50",children:[(0,l.jsx)("td",{className:"px-4 py-3 font-medium",children:t+1}),(0,l.jsx)("td",{className:"px-4 py-3",children:e.circuitName}),(0,l.jsx)("td",{className:"px-4 py-3 font-semibold whitespace-nowrap",children:null==s?void 0:s.name}),(0,l.jsx)("td",{className:"px-4 py-3",children:e.turn}),"lap"===m&&(0,l.jsx)("td",{className:"px-4 py-3",children:"lap"in e?e.lap:"-"}),(0,l.jsx)("td",{className:"px-4 py-3 text-right font-mono",children:v(e.time)}),(0,l.jsx)("td",{className:"px-4 py-3 text-right font-mono text-slate-400",children:a>0?"+".concat(v(a)):"-"})]},t)})})]})})]});case"top":return(0,l.jsx)(y,{circuits:i,players:n,gameHistory:c})}})()})]})},F=e=>{let{onNewGame:t,onAdmin:s}=e;return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-900 p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-md text-center",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold mt-4 text-slate-100",children:"F1 Night "}),(0,l.jsx)("p",{className:"text-slate-400 mt-2 mb-12",children:"Como Empezamos?"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("button",{onClick:t,className:"w-full flex items-center justify-center gap-4 bg-[#FF1801] text-white font-bold py-6 px-4 rounded-lg hover:bg-[#E61601] transition-all text-2xl",children:[(0,l.jsx)("img",{src:"https://storage.googleapis.com/poker-enfermos/f1-logo.png",alt:"F1 Logo",className:"w-10 h-8 object-contain"}),"Nuevo Campeonato"]}),(0,l.jsxs)("button",{onClick:s,className:"w-full flex items-center justify-center gap-4 bg-slate-700 text-white font-bold py-6 px-4 rounded-lg hover:bg-slate-600 transition-all text-2xl",children:[(0,l.jsx)(m,{className:"w-8 h-8"}),"Administracion"]})]})]})})};let k=e=>{let{currentPin:t}=e,[s,r]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[o,d]=(0,a.useState)(""),[x,m]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),{mutate:p}=(0,n.kY)(),g=async e=>{if(e.preventDefault(),m(""),h(""),4!==s.length||!/^\d{4}$/.test(s)){m("Current PIN must be exactly 4 digits.");return}if(4!==i.length||!/^\d{4}$/.test(i)){m("New PIN must be exactly 4 digits.");return}if(i!==o){m("New PINs do not match.");return}if(s===i){m("New PIN must be different from current PIN.");return}try{let e=await fetch("/api/admin/pin",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPin:s,newPin:i})});if(!e.ok){let t=await e.json();m(t.error||"Failed to update PIN.");return}p("/api/settings"),h("PIN updated successfully!"),r(""),c(""),d(""),setTimeout(()=>h(""),3e3)}catch(e){m("Failed to update PIN.")}};return(0,l.jsxs)("form",{onSubmit:g,className:"bg-slate-800 p-4 rounded-lg max-w-sm",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-1 text-sm font-semibold",children:"PIN Actual"}),(0,l.jsx)("input",{type:"password",value:s,onChange:e=>r(e.target.value),maxLength:4,placeholder:"Enter current PIN",className:"w-full p-2 rounded bg-slate-700 text-slate-200",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-1 text-sm font-semibold",children:"Nuevo PIN"}),(0,l.jsx)("input",{type:"password",value:i,onChange:e=>c(e.target.value),maxLength:4,placeholder:"Enter new PIN",className:"w-full p-2 rounded bg-slate-700 text-slate-200",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-400 mb-1 text-sm font-semibold",children:"Confirmar Nuevo PIN"}),(0,l.jsx)("input",{type:"password",value:o,onChange:e=>d(e.target.value),maxLength:4,placeholder:"Confirm new PIN",className:"w-full p-2 rounded bg-slate-700 text-slate-200",required:!0})]})]}),x&&(0,l.jsx)("p",{className:"text-red-500 mt-3 text-sm",children:x}),u&&(0,l.jsx)("p",{className:"text-green-500 mt-3 text-sm",children:u}),(0,l.jsx)("button",{type:"submit",className:"w-full bg-[#FF1801] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#E61601] mt-4 disabled:bg-slate-600 disabled:cursor-not-allowed",disabled:4!==s.length||4!==i.length||4!==o.length,children:"Update PIN"})]})},L=e=>{let{item:t,onSave:s,onCancel:r}=e,n="new-player"===t,i="new-circuit"===t,c=n||"object"==typeof t&&t&&"id"in t&&!i,[o,d]=(0,a.useState)(()=>n||i?{name:"",imageUrl:""}:{...t}),x=e=>{let{name:t,value:s}=e.target;d(e=>({...e,[t]:s}))};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50",children:(0,l.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 w-full max-w-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:n?"Create Player":i?"Create Circuit":"Edit ".concat(o.name)}),(0,l.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!o.name||!o.name.trim()){alert("Name is required");return}if(o.name.trim().length>50){alert("Name must be 50 characters or less");return}if(!o.imageUrl){alert("Image URL is required");return}try{new URL(o.imageUrl)}catch(e){alert("Por favor ingresa una URL v\xe1lida");return}s(o,c?"player":"circuit")},className:"space-y-4",children:[(0,l.jsx)("input",{type:"text",name:"name",value:o.name,onChange:x,placeholder:"Name",required:!0,className:"w-full p-2 rounded bg-slate-700"}),(0,l.jsx)("input",{type:"url",name:"imageUrl",value:o.imageUrl,onChange:x,placeholder:"Image URL",required:!0,className:"w-full p-2 rounded bg-slate-700"}),(0,l.jsxs)("div",{className:"flex justify-end gap-4 mt-6",children:[(0,l.jsx)("button",{type:"button",onClick:r,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"bg-[#FF1801] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#E61601]",children:"Save"})]})]})]})})};var S=e=>{let{players:t,circuits:s,onBack:r,pinCode:i}=e,[c,o]=(0,a.useState)(null),{mutate:d}=(0,n.kY)(),h=async e=>{if(window.confirm("Are you sure you want to delete this player?"))try{let t=await fetch("/api/players/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();alert("Failed to delete player: ".concat(e.error||"Unknown error"));return}d("/api/players")}catch(e){alert("Failed to delete player: Network error")}},p=async e=>{if(window.confirm("Are you sure you want to delete this circuit?"))try{let t=await fetch("/api/circuits/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();alert("Failed to delete circuit: ".concat(e.error||"Unknown error"));return}d("/api/circuits")}catch(e){alert("Failed to delete circuit: Network error")}},g=async(e,t)=>{let s=!e.id,l=s?"/api/".concat(t,"s"):"/api/".concat(t,"s/").concat(e.id);try{let a=await fetch(l,{method:s?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.json();alert("Failed to save ".concat(t,": ").concat(e.error||"Unknown error"));return}d("/api/".concat(t,"s")),o(null)}catch(e){alert("Failed to save ".concat(t,": Network error"))}};return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-4 md:p-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Administracion"}),(0,l.jsx)("button",{onClick:r,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700",children:"Back to Hub"})]}),(0,l.jsxs)("div",{className:"mb-8 pb-8 border-b border-slate-700",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Settings Seguridad"}),(0,l.jsx)(k,{currentPin:i})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:"Jugadores"}),(0,l.jsx)("button",{onClick:()=>o("new-player"),className:"bg-[#FF1801] text-white p-2 rounded-full hover:bg-[#E61601]",children:(0,l.jsx)(x,{className:"w-6 h-6"})})]}),(0,l.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,l.jsxs)("div",{className:"flex items-center bg-slate-800 p-2 rounded-lg",children:[(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-10 h-10 rounded-full mr-4"}),(0,l.jsx)("span",{className:"flex-grow font-semibold",children:e.name}),(0,l.jsx)("button",{onClick:()=>o(e),className:"p-2 text-slate-400 hover:text-white",children:(0,l.jsx)(m,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>h(e.id),className:"p-2 text-slate-400 hover:text-red-500",children:(0,l.jsx)(u,{className:"w-5 h-5"})})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:"Circuitos"}),(0,l.jsx)("button",{onClick:()=>o("new-circuit"),className:"bg-[#FF1801] text-white p-2 rounded-full hover:bg-[#E61601]",children:(0,l.jsx)(x,{className:"w-6 h-6"})})]}),(0,l.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,l.jsxs)("div",{className:"flex items-center bg-slate-800 p-2 rounded-lg",children:[(0,l.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-20 h-10 object-cover rounded mr-4"}),(0,l.jsx)("span",{className:"flex-grow font-semibold",children:e.name}),(0,l.jsx)("button",{onClick:()=>o(e),className:"p-2 text-slate-400 hover:text-white",children:(0,l.jsx)(m,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>p(e.id),className:"p-2 text-slate-400 hover:text-red-500",children:(0,l.jsx)(u,{className:"w-5 h-5"})})]},e.id))})]})]}),c&&(0,l.jsx)(L,{item:c,onSave:g,onCancel:()=>o(null)})]})},I=function(){let[e,t]=(0,a.useState)("login"),[s,c]=(0,a.useState)("race"),{mutate:o}=(0,n.kY)(),{players:d,circuits:x,activeGame:m,pinCode:u,gameHistory:h,isLoading:p,error:b}=function(){let{data:e,error:t,isLoading:s}=(0,r.ZP)("/api/players"),{data:l,error:a,isLoading:n}=(0,r.ZP)("/api/circuits"),{data:i,error:c,isLoading:o}=(0,r.ZP)("/api/game/active"),{data:d,error:x,isLoading:m}=(0,r.ZP)("/api/settings"),{data:u,error:h,isLoading:p}=(0,r.ZP)("/api/game/history");return{players:e,circuits:l,activeGame:null==i?void 0:i.game,pinCode:null==d?void 0:d.pin,gameHistory:u,isLoading:s||n||o||m||p,error:t||a||c||x||h}}(),j=()=>{if(m){let e=m.state.currentCircuitIndex>=m.state.settings.circuits.length;t(e?"results":"race"),c(e?"results":"race")}else t("hub")},f=async e=>{let s={};e.players.forEach(e=>{s[e.id]={totalScore:0,bestLaps:0,bestAverages:0}});let l={settings:e,circuits:e.circuits,playerOrder:e.players.map(e=>e.id),currentCircuitIndex:0,currentTurn:1,currentPlayerIndex:0,circuitResults:Array(e.circuits.length).fill(null).map((t,s)=>({circuitId:e.circuits[s].id,turns:[]})),playerStats:s,sessionBestLap:1/0,sessionBestAverage:1/0,lapTimesLog:[]};try{await fetch("/api/game/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:l})}),await o("/api/game/active"),t("race")}catch(e){console.error("Failed to create game",e),alert("Error: Could not start new game.")}},v=async()=>{if(m)try{await fetch("/api/game/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,status:"COMPLETED"})}),await o("/api/game/active"),await o("/api/game/history")}catch(e){console.error("Failed to archive game",e)}t("setup")},w=async()=>{if(m)try{await fetch("/api/game/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,status:"COMPLETED"})}),await o("/api/game/active"),await o("/api/game/history")}catch(e){console.error("Failed to cancel game",e)}t("hub")},y=()=>t("admin"),k=()=>t("hub"),L=async e=>{if(m)try{o("/api/game/active",{game:{...m,state:e}},!1),await fetch("/api/game/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,state:e,status:"ACTIVE"})}),o("/api/game/active")}catch(e){console.error("Failed to update game state:",e)}},I=(0,a.useCallback)((e,t)=>{if(!m)return;let s=m.state,l=s.sessionBestLap;t.forEach(e=>{e<l&&(l=e)});let a=5===s.settings.lapsPerTurn&&s.settings.useBest4Of5Laps?[...t].sort((e,t)=>e-t).slice(0,4):t,r=Math.round(a.reduce((e,t)=>e+t,0)/a.length),n=s.sessionBestAverage;r<n&&(n=r);let i=[...s.circuitResults];i[s.currentCircuitIndex]||(i[s.currentCircuitIndex]={circuitId:s.circuits[s.currentCircuitIndex].id,turns:[]}),i[s.currentCircuitIndex].turns[s.currentTurn-1]||(i[s.currentCircuitIndex].turns[s.currentTurn-1]=[]),i[s.currentCircuitIndex].turns[s.currentTurn-1].push({playerId:e,lapTimes:t,averageTime:r,turnScore:0});let c=[...s.lapTimesLog];t.forEach((t,l)=>{c.push({playerId:e,circuitName:s.circuits[s.currentCircuitIndex].name,turn:s.currentTurn,lap:l+1,time:t})});let o=s.currentPlayerIndex===s.settings.players.length-1,d=s.currentPlayerIndex+1,x=s.currentTurn,u=s.playerOrder,h=s.playerStats;if(o){let e=i[s.currentCircuitIndex].turns[s.currentTurn-1],t=JSON.parse(JSON.stringify(s.playerStats)),{scoringMethod:l,scoringMultiplier:a}=s.settings,r=e=>0===e?3:1===e?2:2===e?1:0,n=new Map;s.settings.players.forEach(e=>n.set(e.id,0)),e.forEach(e=>e.turnScore=0),("average"===l||"both"===l)&&[...e].sort((e,t)=>{var s,l;return(null!==(s=e.averageTime)&&void 0!==s?s:1/0)-(null!==(l=t.averageTime)&&void 0!==l?l:1/0)}).forEach((e,t)=>{let s=r(t);"both"===l&&(null==a?void 0:a.appliesTo)==="average"&&(s*=a.factor),n.set(e.playerId,(n.get(e.playerId)||0)+s)}),("lap"===l||"both"===l)&&e.map(e=>({playerId:e.playerId,bestLap:Math.min(...e.lapTimes)})).sort((e,t)=>e.bestLap-t.bestLap).forEach((e,t)=>{let s=r(t);"both"===l&&(null==a?void 0:a.appliesTo)==="lap"&&(s*=a.factor),n.set(e.playerId,(n.get(e.playerId)||0)+s)}),e.forEach(e=>{let s=n.get(e.playerId)||0;e.turnScore=s,t[e.playerId].totalScore+=s}),h=t,d=0,x=s.currentTurn+1,u=Object.entries(h).sort((e,t)=>t[1].totalScore-e[1].totalScore).map(e=>{let[t]=e;return t})}L({...s,circuitResults:i,sessionBestLap:l,sessionBestAverage:n,playerStats:h,currentPlayerIndex:d,currentTurn:x,playerOrder:u,lapTimesLog:c})},[m,L]),P=()=>{if(!m)return;let e=m.state,t=e.currentCircuitIndex+1;if(t>=e.settings.circuits.length){T();return}let s=Object.entries(e.playerStats).sort((e,t)=>t[1].totalScore-e[1].totalScore).map(e=>{let[t]=e;return t});L({...e,currentCircuitIndex:t,currentTurn:1,currentPlayerIndex:0,playerOrder:s})},T=async()=>{if(!m)return;let e={...m.state,currentCircuitIndex:m.state.settings.circuits.length};try{o("/api/game/active",{game:{...m,state:e}},!1),await fetch("/api/game/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m.id,state:e,status:"COMPLETED"})}),o("/api/game/active"),o("/api/game/history"),t("results"),c("results")}catch(e){console.error("Failed to end game:",e)}};return p?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Cargando..."}):b?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center text-red-500",children:"Error cargando datos. Int\xe9ntalo m\xe1s tarde."}):(0,l.jsx)("div",{className:"min-h-screen bg-slate-900 text-slate-50",children:(()=>{switch(e){case"login":return(0,l.jsx)(i,{onLoginSuccess:j,pinCode:u});case"hub":return(0,l.jsx)(F,{onNewGame:v,onAdmin:y});case"admin":return(0,l.jsx)(S,{players:d,circuits:x,onBack:k,pinCode:u});case"setup":return(0,l.jsx)(g,{players:d,circuits:x,onSetupComplete:f});case"race":case"results":if(m&&d&&x){let e=m.state,t=e.currentCircuitIndex>=e.settings.circuits.length;return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("div",{className:"bg-slate-900/80 backdrop-blur-sm sticky top-0 z-10 shadow-lg",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,l.jsxs)("div",{className:"flex md:hidden justify-between items-center py-3 border-b border-slate-700",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("img",{src:"https://storage.googleapis.com/poker-enfermos/f1-logo.png",alt:"F1 Logo",className:"w-8 h-6 object-contain"}),(0,l.jsx)("h1",{className:"text-lg font-bold",children:"F1 Night"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:y,className:"p-2 text-slate-300 hover:text-white hover:bg-slate-700 rounded-md transition-colors",title:"Admin Panel",children:(0,l.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,l.jsx)("button",{onClick:()=>{window.confirm("\xbfEst\xe1s seguro de que quieres cancelar este juego? Todo el progreso se perder\xe1.")&&w()},className:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-900/20 rounded-md transition-colors",title:"Cancelar Juego",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,l.jsx)("div",{className:"flex md:hidden justify-center py-2 border-b border-slate-700",children:(0,l.jsxs)("div",{className:"flex border border-slate-600 rounded-lg p-1",children:[(0,l.jsx)("button",{onClick:()=>c("race"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors ".concat("race"===s?"bg-[#FF1801] text-white":"text-slate-300 hover:text-white"),disabled:t,children:"Carrera"}),(0,l.jsx)("button",{onClick:()=>c("results"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors ".concat("results"===s?"bg-[#FF1801] text-white":"text-slate-300 hover:text-white"),children:"Resultados"}),(0,l.jsx)("button",{onClick:y,className:"px-4 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-slate-700 rounded-md transition-colors",children:"Admin"})]})}),(0,l.jsxs)("div",{className:"hidden md:flex justify-between items-center py-3 border-b border-slate-700",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("img",{src:"https://storage.googleapis.com/poker-enfermos/f1-logo.png",alt:"F1 Logo",className:"w-10 h-8 object-contain"}),(0,l.jsx)("h1",{className:"text-xl font-bold",children:"F1 Night"})]}),(0,l.jsxs)("div",{className:"flex border border-slate-600 rounded-lg p-1",children:[(0,l.jsx)("button",{onClick:()=>c("race"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors ".concat("race"===s?"bg-[#FF1801] text-white":"text-slate-300 hover:text-white"),disabled:t,children:"Carrera"}),(0,l.jsx)("button",{onClick:()=>c("results"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors ".concat("results"===s?"bg-[#FF1801] text-white":"text-slate-300 hover:text-white"),children:"Resultados"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("button",{onClick:y,className:"px-3 py-2 text-sm font-semibold text-slate-300 hover:text-white hover:bg-slate-700 rounded-md transition-colors flex items-center gap-2",title:"Admin Panel",children:[(0,l.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,l.jsx)("span",{children:"Admin"})]}),(0,l.jsx)("button",{onClick:()=>{window.confirm("\xbfEst\xe1s seguro de que quieres cancelar este juego? Todo el progreso se perder\xe1.")&&w()},className:"p-2 text-slate-400 hover:text-red-400 hover:bg-red-900/20 rounded-md transition-colors",title:"Cancelar Juego",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]})}),(0,l.jsxs)("main",{className:"mt-4",children:["race"===s&&!t&&(0,l.jsx)(N,{gameState:e,players:d,onTurnComplete:I,onNextCircuit:P,onGameEnd:T}),"results"===s&&(0,l.jsx)(C,{gameState:e,players:d,circuits:x,gameHistory:h||[],onNewGame:v}),t&&"race"===s&&(0,l.jsx)("div",{className:"text-center p-8",children:"Game is finished. Go to Results tab to see the final standings."})]})]})}return(0,l.jsx)("div",{className:"text-center p-8",children:"Loading game... Please wait."});default:return(0,l.jsx)("div",{children:"Something went wrong"})}})()})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);